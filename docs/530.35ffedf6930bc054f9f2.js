(self.webpackChunksteam_ui=self.webpackChunksteam_ui||[]).push([[530],{7530:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FriendsModule:()=>K});var s=n(3423),r=n(9765),c=n(2298),i=n(6215),o=n(739),u=n(7519),a=n(3342),p=n(3190),l=n(6782),d=n(8002),f=n(7716),m=n(1841),g=n(6379);let h=(()=>{class e{constructor(e,t){this.http=e,this.currentUserService=t}getAllUsers$(e=""){return this.http.get("https://cryptic-stream-35838.herokuapp.com/steam/users?search="+e).pipe((0,d.U)(({users:e})=>e))}createFriendRequest$(e){return this.http.post("https://cryptic-stream-35838.herokuapp.com/steam/friends",{to:e}).pipe((0,p.w)(()=>this.updateState$()))}acceptFriendRequest$(e){return this.http.patch("https://cryptic-stream-35838.herokuapp.com/steam/friends/accept",{requestId:e}).pipe((0,p.w)(()=>this.updateState$()))}declineFriendRequest$(e){return this.http.delete("https://cryptic-stream-35838.herokuapp.com/steam/friends/decline",{body:{requestId:e}}).pipe((0,p.w)(()=>this.updateState$()))}removeFriend$(e){return this.http.delete("https://cryptic-stream-35838.herokuapp.com/steam/friends",{body:{friendId:e}}).pipe((0,p.w)(()=>this.updateState$()))}updateState$(){return this.currentUserService.updateCurrentUserInfo$()}}return e.\u0275fac=function(t){return new(t||e)(f.LFG(m.eN),f.LFG(g.K))},e.\u0275prov=f.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var q=n(3738),Z=n(6227),y=n(171),$=n(8583);function A(e,t){1&e&&f.GkF(0)}function w(e,t){if(1&e&&(f.TgZ(0,"mat-expansion-panel"),f.TgZ(1,"mat-expansion-panel-header"),f.TgZ(2,"mat-panel-title"),f._uU(3),f.qZA(),f.qZA(),f.YNc(4,A,1,0,"ng-container",2),f.qZA()),2&e){const e=t.$implicit;f.xp6(3),f.hij(" ",e.header," "),f.xp6(1),f.Q6J("ngTemplateOutlet",e.ref)}}let x=(()=>{class e{constructor(){this.panels=[]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-accordion"]],inputs:{panels:"panels"},decls:2,vars:1,consts:[["multi",""],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"]],template:function(e,t){1&e&&(f.TgZ(0,"mat-accordion",0),f.YNc(1,w,5,2,"mat-expansion-panel",1),f.qZA()),2&e&&(f.xp6(1),f.Q6J("ngForOf",t.panels))},directives:[y.pp,$.sg,y.ib,y.yz,y.yK,$.tP],styles:[""],changeDetection:0}),e})();function R(e,t){1&e&&f.GkF(0)}const b=function(e){return{$implicit:e}};function U(e,t){if(1&e&&(f.TgZ(0,"mat-card",1),f.TgZ(1,"mat-card-content",2),f.TgZ(2,"span"),f._uU(3),f.qZA(),f.YNc(4,R,1,0,"ng-container",3),f.qZA(),f.qZA()),2&e){const e=t.$implicit,n=f.oxw();f.xp6(3),f.Oqu(e.userName),f.xp6(1),f.Q6J("ngTemplateOutlet",n.actions)("ngTemplateOutletContext",f.VKq(3,b,e._id))}}let F=(()=>{class e{constructor(){this.users=[]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-user-cards"]],inputs:{users:"users",actions:"actions"},decls:1,vars:1,consts:[["class","card-user",4,"ngFor","ngForOf"],[1,"card-user"],[1,"card-user-content"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,t){1&e&&f.YNc(0,U,5,5,"mat-card",0),2&e&&f.Q6J("ngForOf",t.users)},directives:[$.sg,q.a8,q.dn,$.tP],styles:[".card-user-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.mat-card[_ngcontent-%COMP%]{margin-top:2em}"],changeDetection:0}),e})();var _=n(1095),v=n(6627);function T(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"mat-card",1),f.TgZ(1,"mat-card-title"),f._uU(2),f.qZA(),f.TgZ(3,"mat-card-subtitle"),f._uU(4),f.ALo(5,"date"),f.qZA(),f.TgZ(6,"button",2),f.NdJ("click",function(){const t=f.CHM(e).$implicit;return f.oxw().decline.emit(t._id)}),f.TgZ(7,"mat-icon"),f._uU(8,"close"),f.qZA(),f.qZA(),f.TgZ(9,"mat-card-actions"),f.TgZ(10,"button",3),f.NdJ("click",function(){const t=f.CHM(e).$implicit;return f.oxw().accept.emit(t._id)}),f._uU(11,"Accept"),f.qZA(),f.TgZ(12,"button",4),f.NdJ("click",function(){const t=f.CHM(e).$implicit;return f.oxw().decline.emit(t._id)}),f._uU(13,"Decline"),f.qZA(),f.qZA(),f.qZA()}if(2&e){const e=t.$implicit;f.xp6(2),f.hij("Request from ",e.from.userName,""),f.xp6(2),f.hij("Sent at ",f.xi3(5,2,e.addedAt,"MMM/dd, h a"),"")}}let O=(()=>{class e{constructor(){this.friendRequests=[],this.accept=new f.vpe,this.decline=new f.vpe}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-friend-requests"]],inputs:{friendRequests:"friendRequests"},outputs:{accept:"accept",decline:"decline"},decls:2,vars:1,consts:[["class","card-request",4,"ngFor","ngForOf"],[1,"card-request"],["mat-icon-button","","aria-label","Decline request","color","warn",1,"button-close",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(f.TgZ(0,"mat-card-content"),f.YNc(1,T,14,5,"mat-card",0),f.qZA()),2&e&&(f.xp6(1),f.Q6J("ngForOf",t.friendRequests))},directives:[q.dn,$.sg,q.a8,q.n5,q.$j,_.lW,v.Hw,q.hq],pipes:[$.uU],styles:[".card-request[_ngcontent-%COMP%]{margin-top:1em}.button-close[_ngcontent-%COMP%]{position:absolute;top:0;right:5px}"],changeDetection:0}),e})();function I(e,t){if(1&e&&(f.ynx(0),f.TgZ(1,"h2",0),f._uU(2,"You might wanna play with..."),f.qZA(),f._UZ(3,"app-user-cards",9),f.ALo(4,"async"),f.BQk()),2&e){const e=f.oxw(),t=f.MAs(15);f.xp6(3),f.Q6J("users",f.lcZ(4,2,e.queryResult$))("actions",t)}}function M(e,t){if(1&e&&f._UZ(0,"app-user-cards",9),2&e){const e=t.ngIf;f.oxw(2);const n=f.MAs(13);f.Q6J("users",e.friends)("actions",n)}}function N(e,t){if(1&e&&(f.YNc(0,M,1,2,"app-user-cards",10),f.ALo(1,"async")),2&e){const e=f.oxw();f.Q6J("ngIf",f.lcZ(1,1,e.currentUserInfo$))}}function k(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"app-friend-requests",13),f.NdJ("accept",function(t){return f.CHM(e),f.oxw(2).onAcceptRequest(t)})("decline",function(t){return f.CHM(e),f.oxw(2).onDeclineRequest(t)}),f.ALo(1,"async"),f.qZA()}if(2&e){const e=f.oxw(2);f.Q6J("friendRequests",f.lcZ(1,1,e.friendRequests$))}}function S(e,t){1&e&&(f.TgZ(0,"p"),f._uU(1,"You've got no friend requests for now"),f.qZA())}function C(e,t){if(1&e&&(f.YNc(0,k,2,3,"app-friend-requests",11),f.ALo(1,"async"),f.YNc(2,S,2,0,"ng-template",null,12,f.W1O)),2&e){const e=f.MAs(3),t=f.oxw();let n;f.Q6J("ngIf",null==(n=f.lcZ(1,2,t.friendRequests$))?null:n.length)("ngIfElse",e)}}function J(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"button",14),f.NdJ("click",function(){const t=f.CHM(e).$implicit;return f.oxw().onRemoveFriend(t)}),f._uU(1,"Remove friend"),f.qZA()}}function Y(e,t){1&e&&(f.ynx(0),f.TgZ(1,"button",16),f._uU(2,"Request sent"),f.qZA(),f.BQk())}function Q(e,t){if(1&e){const e=f.EpF();f.TgZ(0,"button",17),f.NdJ("click",function(){f.CHM(e);const t=f.oxw().$implicit;return f.oxw().onAddFriend(t)}),f._uU(1,"Add friend"),f.qZA()}}function L(e,t){if(1&e&&(f.YNc(0,Y,3,0,"ng-container",3),f.ALo(1,"async"),f.YNc(2,Q,2,0,"ng-template",null,15,f.W1O)),2&e){const e=t.$implicit,n=f.MAs(3),s=f.oxw();f.Q6J("ngIf",f.lcZ(1,2,s.isRequestSent$(e)))("ngIfElse",n)}}function W(e,t){1&e&&(f.TgZ(0,"p",18),f._uU(1,"Search for some new friends...!"),f.qZA())}const D=function(e){return{header:"My Friends",ref:e}},E=function(e){return{header:"Friend Requests",ref:e}},j=function(e,t){return[e,t]},B=[{path:"",pathMatch:"full",component:(()=>{class e{constructor(e,t){this.usersService=e,this.currentUserService=t,this.destroy$=new r.xQ,this.currentUserInfo$=new c.t(1),this.queryResult$=new i.X([]),this.queryChange$=new i.X("")}ngOnInit(){(0,o.aj)([this.currentUserService.getCurrentUserInfo$(),this.queryChange$.pipe((0,u.x)())]).pipe((0,a.b)(([e])=>{this.currentUserInfo$.next(e)}),(0,p.w)(([e,t])=>this.updateQueryResult$(e,t)),(0,l.R)(this.destroy$)).subscribe()}get friendRequests$(){return this.currentUserInfo$.pipe((0,d.U)(e=>e.friendRequests.filter(t=>t.from._id!==e._id)))}onSearchInput(e){this.queryChange$.next(e.trim())}onAddFriend(e){this.usersService.createFriendRequest$(e).pipe((0,l.R)(this.destroy$)).subscribe()}onRemoveFriend(e){this.usersService.removeFriend$(e).pipe((0,l.R)(this.destroy$)).subscribe()}onAcceptRequest(e){this.usersService.acceptFriendRequest$(e).pipe((0,l.R)(this.destroy$)).subscribe()}onDeclineRequest(e){this.usersService.declineFriendRequest$(e).pipe((0,l.R)(this.destroy$)).subscribe()}isRequestSent$(e){return this.currentUserInfo$.pipe((0,d.U)(t=>t.friendRequests.some(t=>t.from._id===e||t.to._id===e)))}updateQueryResult$(e,t){return this.usersService.getAllUsers$(t).pipe((0,d.U)(t=>this.filterUsers(t,e)),(0,a.b)(e=>this.queryResult$.next(e)))}filterUsers(e,t){return e.filter(e=>{const n=e._id;return t.friends.every(e=>e._id!==n)&&n!==t._id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(f.Y36(h),f.Y36(g.K))},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-friends"]],decls:18,vars:12,consts:[[1,"mt-2em"],["labelText","Search new Friends",3,"queryInput"],[3,"panels"],[4,"ngIf","ngIfElse"],["friends",""],["requests",""],["friendsActions",""],["usersActions",""],["noResults",""],[3,"users","actions"],[3,"users","actions",4,"ngIf"],[3,"friendRequests","accept","decline",4,"ngIf","ngIfElse"],["noFriendRequests",""],[3,"friendRequests","accept","decline"],["mat-raised-button","","color","warn",3,"click"],["addFriendButton",""],["mat-raised-button","","disabled",""],["mat-raised-button","","color","primary",3,"click"],[1,"new-friends-text"]],template:function(e,t){if(1&e&&(f.TgZ(0,"mat-card",0),f.TgZ(1,"mat-card-title"),f._uU(2,"Friends"),f.qZA(),f.TgZ(3,"mat-card-content"),f.TgZ(4,"app-search-form",1),f.NdJ("queryInput",function(e){return t.onSearchInput(e)}),f.qZA(),f._UZ(5,"app-accordion",2),f.YNc(6,I,5,4,"ng-container",3),f.ALo(7,"async"),f.qZA(),f.qZA(),f.YNc(8,N,2,3,"ng-template",null,4,f.W1O),f.YNc(10,C,4,4,"ng-template",null,5,f.W1O),f.YNc(12,J,2,0,"ng-template",null,6,f.W1O),f.YNc(14,L,4,4,"ng-template",null,7,f.W1O),f.YNc(16,W,2,0,"ng-template",null,8,f.W1O)),2&e){const e=f.MAs(9),n=f.MAs(11),s=f.MAs(17);let r;f.xp6(5),f.Q6J("panels",f.WLB(9,j,f.VKq(5,D,e),f.VKq(7,E,n))),f.xp6(1),f.Q6J("ngIf",null==(r=f.lcZ(7,3,t.queryResult$))?null:r.length)("ngIfElse",s)}},directives:[q.a8,q.n5,q.dn,Z.o,x,$.O5,F,O,_.lW],pipes:[$.Ov],styles:[".mt-2em[_ngcontent-%COMP%]{margin-top:2em}.new-friends-text[_ngcontent-%COMP%]{text-align:center;margin-top:2em;font-size:20px}"],changeDetection:0}),e})()}];let H=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[s.Bz.forChild(B)],s.Bz]}),e})();var P=n(421);let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[H,P.m]]}),e})()}}]);