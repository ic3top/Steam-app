(self.webpackChunksteam_ui=self.webpackChunksteam_ui||[]).push([[148],{5148:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GamesModule:()=>Q});var r=n(9838),i=n(9765),a=n(6215),s=n(739),o=n(3190),c=n(6782),g=n(7716),p=n(8002),l=n(7349),d=n(5304),m=n(5917),u=n(1841),h=n(6379);let f=(()=>{class e{constructor(e,t,n,r){this.http=e,this.currentUserService=t,this.router=n,this.baseUrl=r}getAllGames$(e="",t,n){const r=`search=${e}`,i=`maxPrice=${t>0?t:100}`,a=n.map(e=>"genres="+e).join("&");return this.http.get(`${this.baseUrl}/games?${r}&${i}&${a}`).pipe((0,p.U)(({games:e})=>e))}isGameInLibrary$(e){return this.currentUserService.getCurrentUserInfo$().pipe((0,p.U)(e=>e.games),(0,p.U)(t=>t.some(({_id:t})=>e===t)),(0,l.d)())}getGameById$(e){return this.http.get(`${this.baseUrl}/games/`+e).pipe(function(...e){const t=e.length;if(0===t)throw new Error("list of properties cannot be empty.");return n=>(0,p.U)(function(e,t){return n=>{let r=n;for(let i=0;i<t;i++){const t=null!=r?r[e[i]]:void 0;if(void 0===t)return;r=t}return r}}(e,t))(n)}("game"),(0,l.d)())}addGameToLibrary$(e){return this.http.patch(`${this.baseUrl}/profile/me/games`,{gameId:e}).pipe((0,d.K)(e=>(401===e.status&&(console.warn("You must log in"),this.router.navigate(["/auth/login"])),(0,m.of)({}))),(0,o.w)(()=>this.currentUserService.updateCurrentUserInfo$()))}}return e.\u0275fac=function(t){return new(t||e)(g.LFG(u.eN),g.LFG(h.K),g.LFG(r.F0),g.LFG("BASE_URL"))},e.\u0275prov=g.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var y=n(3738),b=n(6227),x=n(8583),Z=n(3679),A=n(4436),w=n(7539);function C(e,t){1&e&&(g.TgZ(0,"span"),g._uU(1,"Any price"),g.qZA())}function $(e,t){if(1&e){const e=g.EpF();g.ynx(0,8),g.TgZ(1,"mat-checkbox",9),g.NdJ("change",function(){return g.CHM(e),g.oxw(2).changeGenres()}),g._uU(2),g.qZA(),g.BQk()}if(2&e){const e=t.$implicit,n=t.index;g.xp6(1),g.Q6J("formControlName",n),g.xp6(1),g.hij(" ",e," ")}}const T=function(){return{standalone:!0}};function v(e,t){if(1&e){const e=g.EpF();g.TgZ(0,"div",5),g.TgZ(1,"h3"),g._uU(2,"Genres"),g.qZA(),g.TgZ(3,"mat-checkbox",6),g.NdJ("ngModelChange",function(t){return g.CHM(e),g.oxw().anyGenreChecked=t})("change",function(){return g.CHM(e),g.oxw().markAllGenres()}),g._uU(4," Any genre "),g.qZA(),g.YNc(5,$,3,2,"ng-container",7),g.qZA()}if(2&e){const e=g.oxw();g.xp6(3),g.Q6J("ngModel",e.anyGenreChecked)("ngModelOptions",g.DdM(4,T))("disabled",e.anyGenreChecked),g.xp6(2),g.Q6J("ngForOf",e.genres)}}let I=(()=>{class e{constructor(e){this.fb=e,this.genres=[],this.changeFilters=new g.vpe,this.anyGenreChecked=!0}ngOnInit(){this.filtersForm=this.fb.group({maxPrice:[0],genresCheckboxes:this.fb.array(this.genres.map(()=>!0))}),this.emitChangeFilters()}get genresCheckboxes(){return this.filtersForm.controls.genresCheckboxes}get isAnyPrice(){const e=this.filtersForm.controls.maxPrice.value;return 0===e||100===e}formatPrice(e){return e>0?e+"$":e}markAllGenres(){this.genresCheckboxes.setValue(this.genres.map(()=>!0)),this.emitChangeFilters()}changeGenres(){this.anyGenreChecked=this.genresCheckboxes.value.every(Boolean),this.emitChangeFilters()}emitChangeFilters(){this.changeFilters.emit({maxPrice:this.filtersForm.value.maxPrice,genres:this.genres.filter((e,t)=>this.genresCheckboxes.value[t])})}}return e.\u0275fac=function(t){return new(t||e)(g.Y36(Z.qu))},e.\u0275cmp=g.Xpm({type:e,selectors:[["app-filters"]],inputs:{genres:"genres"},outputs:{changeFilters:"changeFilters"},decls:8,vars:4,consts:[[1,"flex-column","filters-wrapper",3,"formGroup"],["formControlName","maxPrice","aria-label","price","thumbLabel","",3,"displayWith","change"],[1,"price-text"],[4,"ngIf"],["class","flex-column",4,"ngIf"],[1,"flex-column"],[3,"ngModel","ngModelOptions","disabled","ngModelChange","change"],["formArrayName","genresCheckboxes",4,"ngFor","ngForOf"],["formArrayName","genresCheckboxes"],["color","primary",3,"formControlName","change"]],template:function(e,t){1&e&&(g.TgZ(0,"div",0),g.TgZ(1,"div"),g.TgZ(2,"h3"),g._uU(3,"Max Price"),g.qZA(),g.TgZ(4,"mat-slider",1),g.NdJ("change",function(){return t.emitChangeFilters()}),g.qZA(),g.TgZ(5,"p",2),g.YNc(6,C,2,0,"span",3),g.qZA(),g.qZA(),g.YNc(7,v,6,5,"div",4),g.qZA()),2&e&&(g.Q6J("formGroup",t.filtersForm),g.xp6(4),g.Q6J("displayWith",t.formatPrice),g.xp6(2),g.Q6J("ngIf",t.isAnyPrice),g.xp6(1),g.Q6J("ngIf",t.genres.length>0))},directives:[Z.JL,Z.sg,A.pH,Z.JJ,Z.u,x.O5,w.oG,Z.On,x.sg,Z.CE],styles:[".filters-wrapper[_ngcontent-%COMP%]{grid-gap:1em;gap:1em;padding:2em;position:sticky;top:40px}.flex-column[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-slider[_ngcontent-%COMP%]{min-width:200px}.price-text[_ngcontent-%COMP%]{height:20px;text-align:center}"],changeDetection:0}),e})();var L=n(4929),q=n(1095);function G(e,t){if(1&e&&(g.TgZ(0,"button",2),g._uU(1," Already in library\n"),g.qZA()),2&e){const e=g.oxw();g.ekj("full-width",e.fullWidth)}}function _(e,t){if(1&e){const e=g.EpF();g.TgZ(0,"button",3),g.NdJ("click",function(){return g.CHM(e),g.oxw().addToLibrary.emit()}),g._uU(1," Add to library "),g.qZA()}if(2&e){const e=g.oxw();g.ekj("full-width",e.fullWidth)}}let F=(()=>{class e{constructor(){this.isInLibrary=!1,this.fullWidth=!1,this.addToLibrary=new g.vpe}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=g.Xpm({type:e,selectors:[["app-add-button"]],inputs:{isInLibrary:"isInLibrary",fullWidth:"fullWidth"},outputs:{addToLibrary:"addToLibrary"},decls:3,vars:2,consts:[["mat-raised-button","","disabled","",3,"full-width",4,"ngIf","ngIfElse"],["addButton",""],["mat-raised-button","","disabled",""],["mat-raised-button","","color","primary",3,"click"]],template:function(e,t){if(1&e&&(g.YNc(0,G,2,2,"button",0),g.YNc(1,_,2,2,"ng-template",null,1,g.W1O)),2&e){const e=g.MAs(2);g.Q6J("ngIf",t.isInLibrary)("ngIfElse",e)}},directives:[x.O5,q.lW],styles:[".full-width[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),e})();function O(e,t){if(1&e&&g._UZ(0,"app-game-card",6),2&e){const e=t.$implicit;g.oxw();const n=g.MAs(13);g.Q6J("game",e)("templateRef",n)}}function k(e,t){if(1&e){const e=g.EpF();g.TgZ(0,"app-add-button",7),g.NdJ("addToLibrary",function(){const t=g.CHM(e).$implicit;return g.oxw().addGameToLibrary(t._id)}),g.ALo(1,"async"),g.qZA()}if(2&e){const e=t.$implicit,n=g.oxw();g.Q6J("fullWidth",!0)("isInLibrary",g.lcZ(1,2,n.isInLibrary$(e._id)))}}let M=(()=>{class e{constructor(e,t){this.activatedRoute=e,this.gamesService=t,this.destroy$=new i.xQ,this.GENRES=["RPG","Strategy","Action","Indie","Adventure"],this.games$=new i.xQ,this.filterChange$=new i.xQ,this.searchInput$=new a.X("")}ngOnInit(){(0,s.aj)([this.searchInput$,this.filterChange$]).pipe((0,o.w)(([e,t])=>this.gamesService.getAllGames$(e,t.maxPrice,t.genres))).pipe((0,c.R)(this.destroy$)).subscribe(e=>this.games$.next(e))}onSearchInput(e){this.searchInput$.next(e.trim())}onChangeFilters(e){this.filterChange$.next(e)}addGameToLibrary(e){this.gamesService.addGameToLibrary$(e).pipe((0,c.R)(this.destroy$)).subscribe()}isInLibrary$(e){return this.gamesService.isGameInLibrary$(e)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(g.Y36(r.gz),g.Y36(f))},e.\u0275cmp=g.Xpm({type:e,selectors:[["app-games"]],decls:14,vars:4,consts:[["labelText","Search Games",3,"queryInput"],[1,"board"],[1,"games-wrapper"],[3,"game","templateRef",4,"ngFor","ngForOf"],[3,"genres","changeFilters"],["actions",""],[3,"game","templateRef"],[3,"fullWidth","isInLibrary","addToLibrary"]],template:function(e,t){1&e&&(g.TgZ(0,"mat-card"),g.TgZ(1,"mat-card-title"),g._uU(2,"Games"),g.qZA(),g.TgZ(3,"mat-card-content"),g.TgZ(4,"app-search-form",0),g.NdJ("queryInput",function(e){return t.onSearchInput(e)}),g.qZA(),g.TgZ(5,"h2"),g._uU(6,"Featured Games"),g.qZA(),g.TgZ(7,"div",1),g.TgZ(8,"div",2),g.YNc(9,O,1,2,"app-game-card",3),g.ALo(10,"async"),g.qZA(),g.TgZ(11,"app-filters",4),g.NdJ("changeFilters",function(e){return t.onChangeFilters(e)}),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.YNc(12,k,2,4,"ng-template",null,5,g.W1O)),2&e&&(g.xp6(9),g.Q6J("ngForOf",g.lcZ(10,2,t.games$)),g.xp6(2),g.Q6J("genres",t.GENRES))},directives:[y.a8,y.n5,y.dn,b.o,x.sg,I,L.k,F],pipes:[x.Ov],styles:[".board[_ngcontent-%COMP%]{margin-top:2em;display:flex;justify-content:space-between}.games-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));grid-gap:1em}"],changeDetection:0}),e})();var U=n(7574);function J(e,t){if(1&e){const e=g.EpF();g.TgZ(0,"mat-card"),g.TgZ(1,"mat-card-header"),g.TgZ(2,"mat-card-title"),g._uU(3),g.qZA(),g.qZA(),g.TgZ(4,"mat-card-content"),g.TgZ(5,"span",1),g._uU(6),g.qZA(),g.TgZ(7,"div",2),g._UZ(8,"img",3),g.qZA(),g.TgZ(9,"div",4),g.TgZ(10,"p",5),g._uU(11),g.qZA(),g.TgZ(12,"div",6),g.TgZ(13,"span",7),g._uU(14),g.qZA(),g.TgZ(15,"span",7),g._uU(16),g.qZA(),g.TgZ(17,"span",7),g._uU(18),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(19,"mat-card-actions"),g.TgZ(20,"app-add-button",8),g.NdJ("addToLibrary",function(){return g.CHM(e),g.oxw().onAddToLibrary()}),g.ALo(21,"async"),g.qZA(),g.TgZ(22,"button",9),g._uU(23,"Go to games"),g.qZA(),g.qZA(),g.qZA()}if(2&e){const e=t.ngIf,n=g.oxw();g.xp6(3),g.Oqu(e.title),g.xp6(3),g.hij(" ",e.price," $ "),g.xp6(2),g.Q6J("src",e.img,g.LSH)("alt",e.alt||"Game preview"),g.xp6(3),g.hij(" ",e.description," "),g.xp6(3),g.hij("Genre: ",e.genre,""),g.xp6(2),g.hij("Rating: ",e.rating,"/10"),g.xp6(2),g.hij("Year: ",e.year,""),g.xp6(2),g.Q6J("isInLibrary",g.lcZ(21,9,n.isInLibrary$))}}const P=[{path:"",pathMatch:"full",component:M},{path:":gameId",component:(()=>{class e{constructor(e,t,n){this.route=e,this.router=t,this.gamesService=n,this.destroy$=new i.xQ,this.gameId="",this.isInLibrary$=new U.y,this.gameId=this.route.snapshot.paramMap.get("gameId")}ngOnInit(){this.game$=this.gamesService.getGameById$(this.gameId),this.game$.pipe((0,c.R)(this.destroy$)).subscribe({error:()=>this.router.navigate(["/404"])}),this.isInLibrary$=this.gamesService.isGameInLibrary$(this.gameId)}onAddToLibrary(){this.gamesService.addGameToLibrary$(this.gameId).pipe((0,c.R)(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(g.Y36(r.gz),g.Y36(r.F0),g.Y36(f))},e.\u0275cmp=g.Xpm({type:e,selectors:[["app-game-details"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"game-price","badge"],[1,"game-image-wrapper"],["mat-card-image","",1,"game-image",3,"src","alt"],[1,"game-details"],[1,"game-description"],[1,"game-features"],[1,"badge"],[3,"isInLibrary","addToLibrary"],["mat-raised-button","","routerLink","/games"]],template:function(e,t){1&e&&(g.YNc(0,J,24,11,"mat-card",0),g.ALo(1,"async")),2&e&&g.Q6J("ngIf",g.lcZ(1,1,t.game$))},directives:[x.O5,y.a8,y.dk,y.n5,y.dn,y.G2,y.hq,F,q.lW,r.rH],pipes:[x.Ov],styles:[".mat-card-content[_ngcontent-%COMP%]{display:grid;align-items:center;justify-items:center;grid-template-columns:300px 1fr;grid-gap:2em}.game-image-wrapper[_ngcontent-%COMP%]{max-width:300px}.game-image[_ngcontent-%COMP%]{max-width:100%}.game-description[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.game-features[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;font-size:16px;margin-top:3em;grid-gap:.5em;gap:.5em}.badge[_ngcontent-%COMP%]{padding:5px 15px;border-radius:5px;color:#fff;background-color:#9a00c2}.game-price[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;font-size:16px;font-weight:600;background-color:#e6ad02}"],changeDetection:0}),e})()}];let N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=g.oAB({type:e}),e.\u0275inj=g.cJS({imports:[[r.Bz.forChild(P)],r.Bz]}),e})();var S=n(9156);let Q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=g.oAB({type:e}),e.\u0275inj=g.cJS({imports:[[N,S.m]]}),e})()}}]);